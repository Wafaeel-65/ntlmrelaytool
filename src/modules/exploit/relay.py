from src.modules.exploit.ntlmrelayserver import NTLMRelayServer
import logging

# Configure logging
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

class Relay:
    def __init__(self, interface='0.0.0.0', port=445):
        self.server = NTLMRelayServer(interface, port)
        self.running = False
        self.logger = logging.getLogger(__name__)

    def set_target(self, target):
        """Set the target for NTLM relay"""
        self.server.set_target(target)

    def start_relay(self, target=None):
        """Start the relay server with an optional target"""
        try:
            if target:
                self.set_target(target)
            self.server.start()
            self.running = True
        except Exception as e:
            self.logger.error(f"Failed to start relay: {e}")
            raise

    def stop_relay(self):
        """Stop the relay server"""
        try:
            self.server.stop()
            self.running = False
        except Exception as e:
            self.logger.error(f"Failed to stop relay: {e}")
            raise
